{{- $contextType := printf "%T" . -}}
{{- $isShortcode := (eq $contextType "*hugolib.ShortcodeWithPage") -}}

{{/* ---------------------------------------------------------------------------
SECTION TITLE
--------------------------------------------------------------------------- */}}
{{- $title := "" -}}
{{- if $isShortcode }}
{{- $title = .Get "title" -}}
{{- else }}
{{- $title = i18n "testimonials_title" -}}
{{- end }}

{{/* ---------------------------------------------------------------------------
TESTIMONIALS COLLECTION
--------------------------------------------------------------------------- */}}
{{- $testimonials := (where .Site.RegularPages.ByDate "Type" "testimonial") -}}
{{- if not $isShortcode }}
{{- $baseLangSite := .Sites.Default -}}
{{- $testimonials = $testimonials | lang.Merge (where $baseLangSite.RegularPages.ByDate "Type" "testimonial") -}}
{{- end -}}

{{ $sectionId := "testimonial" }}
{{ with .Get "sectionId" }}
{{ $sectionId = . }}
{{ end }}

<section {{if $sectionId}} id="{{ $sectionId }}" {{end}} class="section rad-animation-group section--border-bottom">
  <div class="container">
    <h2 class="rad-fade-down">{{ $title }}</h2>
    <div class="row row--padded mb-0 rad-fade-down">
      {{ range $testimonials }}
      <div class="col-12 col-md-4 mb-5 mb-md-0 testimonial container">
        <i class="icon-quote-left"></i>
        {{ .Content }}
        <div class="testimonial__author">
          <div class="testimonial__author-info">
            <h3>{{ .Params.name }}</h3>
            <span>{{ .Params.position }}</span>
          </div>
        </div>
      </div>
      {{ end }}
    </div>

    <!-- Comment Section -->
    <div class="row pt-5 rad-fade-down">
      <div class="col-12">
        <div class="comment-header text-center mb-4">
          <h3>Để lại cảm nghĩ của bạn</h3>
          <p>Bạn có thể bình luận bằng cách đăng nhập Gmail, Facebook hoặc đăng với tư cách khách.</p>
        </div>

        {{ $currentPermalink := "" }}
        {{ if $isShortcode }}
        {{ $currentPermalink = .Page.Permalink }}
        {{ else }}
        {{ $currentPermalink = .Permalink }}
        {{ end }}
        <div id="disqus_thread"></div>
        <script>
          var disqus_config = function () {
            this.page.url = "{{ $currentPermalink | absURL }}";
            this.page.identifier = "home-testimonials";
          };
          (function () {
            var d = document, s = d.createElement('script');
            s.src = 'https://https-taynguyentruong-github-io-nguyentruongsontay.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
      </div>
    </div>
  </div>
</section>